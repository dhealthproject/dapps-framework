<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>AuthService | @dhealthdapps/backend</title><meta name="description" content="Documentation for @dhealthdapps/backend"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script async src="../assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base=".."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="../index.html" class="title">@dhealthdapps/backend</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><ul class="tsd-breadcrumb"><li><a href="../modules.html">@dhealthdapps/backend</a></li><li><a href="AuthService.html">AuthService</a></li></ul><h1>Class AuthService </h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><section class="tsd-panel tsd-comment"><div class="tsd-comment tsd-typography"><dl class="tsd-comment-tags"><dt>label</dt><dd><p>COMMON</p>
</dd><dt>description</dt><dd><p>This class serves as an <em>authentication handler</em> for users.
This can be used to <em>authenticate</em> the access to [a subset] of your dApp
routes and modules.
<br /><br />
You can use this service to <em>generate authentication challenges</em>, or to
<em>validate the presence of authentication challenges</em> on-chain, or to get
<em>access tokens</em> and <em>refresh tokens</em> for authenticated users.</p>
</dd><dt>since</dt><dd><p>v0.2.0</p>
</dd></dl></div></section><section class="tsd-panel tsd-hierarchy"><h3>Hierarchy</h3><ul class="tsd-hierarchy"><li><span class="target">AuthService</span></li></ul></section><section class="tsd-panel-group tsd-index-group"><h2>Index</h2><section class="tsd-panel tsd-index-panel"><div class="tsd-index-content"><section class="tsd-index-section "><h3>Constructors</h3><ul class="tsd-index-list"><li class="tsd-kind-constructor tsd-parent-kind-class"><a href="AuthService.html#constructor" class="tsd-kind-icon">constructor</a></li></ul></section><section class="tsd-index-section tsd-is-private-protected"><h3>Properties</h3><ul class="tsd-index-list"><li class="tsd-kind-property tsd-parent-kind-class tsd-is-protected"><a href="AuthService.html#challengeSize" class="tsd-kind-icon">challenge<wbr/>Size</a></li><li class="tsd-kind-property tsd-parent-kind-class tsd-is-protected"><a href="AuthService.html#cookie" class="tsd-kind-icon">cookie</a></li></ul></section><section class="tsd-index-section "><h3>Methods</h3><ul class="tsd-index-list"><li class="tsd-kind-method tsd-parent-kind-class tsd-is-protected"><a href="AuthService.html#findRecentChallenge" class="tsd-kind-icon">find<wbr/>Recent<wbr/>Challenge</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="AuthService.html#getAccessToken" class="tsd-kind-icon">get<wbr/>Access<wbr/>Token</a></li><li class="tsd-kind-method tsd-parent-kind-class tsd-is-protected"><a href="AuthService.html#getAccountQuery" class="tsd-kind-icon">get<wbr/>Account<wbr/>Query</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="AuthService.html#getChallenge" class="tsd-kind-icon">get<wbr/>Challenge</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="AuthService.html#getCookie" class="tsd-kind-icon">get<wbr/>Cookie</a></li><li class="tsd-kind-method tsd-parent-kind-class tsd-is-protected"><a href="AuthService.html#getTransactionQuery" class="tsd-kind-icon">get<wbr/>Transaction<wbr/>Query</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="AuthService.html#refreshAccessToken" class="tsd-kind-icon">refresh<wbr/>Access<wbr/>Token</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="AuthService.html#validateChallenge" class="tsd-kind-icon">validate<wbr/>Challenge</a></li></ul></section></div></section></section><section class="tsd-panel-group tsd-member-group "><h2>Constructors</h2><section class="tsd-panel tsd-member tsd-kind-constructor tsd-parent-kind-class"><a id="constructor" class="tsd-anchor"></a><h3 class="tsd-anchor-link">constructor<a href="#constructor" aria-label="Permalink" class="tsd-anchor-icon"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5"></path><path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5"></path></svg></a></h3><ul class="tsd-signatures tsd-kind-constructor tsd-parent-kind-class"><li class="tsd-signature tsd-kind-icon">new <wbr/>Auth<wbr/>Service<span class="tsd-signature-symbol">(</span>configService<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">ConfigService</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">Record</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">, </span><span class="tsd-signature-type">unknown</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">, </span><span class="tsd-signature-type">false</span><span class="tsd-signature-symbol">&gt;</span>, networkService<span class="tsd-signature-symbol">: </span><a href="NetworkService.html" class="tsd-signature-type" data-tsd-kind="Class">NetworkService</a>, accountsService<span class="tsd-signature-symbol">: </span><a href="AccountsService.html" class="tsd-signature-type" data-tsd-kind="Class">AccountsService</a>, challengesService<span class="tsd-signature-symbol">: </span><a href="ChallengesService.html" class="tsd-signature-type" data-tsd-kind="Class">ChallengesService</a>, jwtService<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">JwtService</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><a href="AuthService.html" class="tsd-signature-type" data-tsd-kind="Class">AuthService</a></li></ul><ul class="tsd-descriptions"><li class="tsd-description"><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/dhealthproject/dapps-framework/blob/80c5baa/runtime/backend/src/common/services/AuthService.ts#L153">src/common/services/AuthService.ts:153</a></li></ul></aside><div class="tsd-comment tsd-typography"><div class="lead">
<p>Constructs an instance of the authentication service and sets
up the <em>cookie generation</em> and <em>challenge generation</em> routines.</p>
</div><dl class="tsd-comment-tags"><dt>access</dt><dd><p>public</p>
</dd></dl></div><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameters"><li><h5>configService: <span class="tsd-signature-type">ConfigService</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">Record</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">, </span><span class="tsd-signature-type">unknown</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">, </span><span class="tsd-signature-type">false</span><span class="tsd-signature-symbol">&gt;</span></h5></li><li><h5>networkService: <a href="NetworkService.html" class="tsd-signature-type" data-tsd-kind="Class">NetworkService</a></h5></li><li><h5>accountsService: <a href="AccountsService.html" class="tsd-signature-type" data-tsd-kind="Class">AccountsService</a></h5></li><li><h5>challengesService: <a href="ChallengesService.html" class="tsd-signature-type" data-tsd-kind="Class">ChallengesService</a></h5></li><li><h5>jwtService: <span class="tsd-signature-type">JwtService</span></h5><div class="tsd-comment tsd-typography"><div class="lead">
</div></div></li></ul><h4 class="tsd-returns-title">Returns <a href="AuthService.html" class="tsd-signature-type" data-tsd-kind="Class">AuthService</a></h4></li></ul></section></section><section class="tsd-panel-group tsd-member-group tsd-is-private-protected"><h2>Properties</h2><section class="tsd-panel tsd-member tsd-kind-property tsd-parent-kind-class tsd-is-protected"><a id="challengeSize" class="tsd-anchor"></a><h3 class="tsd-anchor-link"><span class="tsd-flag ts-flagProtected">Protected</span> challenge<wbr/>Size<a href="#challengeSize" aria-label="Permalink" class="tsd-anchor-icon"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5"></path><path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5"></path></svg></a></h3><div class="tsd-signature tsd-kind-icon">challenge<wbr/>Size<span class="tsd-signature-symbol">:</span> <span class="tsd-signature-type">number</span></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/dhealthproject/dapps-framework/blob/80c5baa/runtime/backend/src/common/services/AuthService.ts#L139">src/common/services/AuthService.ts:139</a></li></ul></aside><div class="tsd-comment tsd-typography"><div class="lead">
<p>Contains the <em>challenge size</em> as set in <code>config.security.ts</code>.
<br /><br />
Note that by modifying the default <em>challenge size</em>, you may
affect the operations processor and thereby the data that is
returned by the backend.</p>
</div><dl class="tsd-comment-tags"><dt>access</dt><dd><p>protected</p>
</dd><dt>var</dt><dd><p>{number}</p>
</dd></dl></div></section><section class="tsd-panel tsd-member tsd-kind-property tsd-parent-kind-class tsd-is-protected"><a id="cookie" class="tsd-anchor"></a><h3 class="tsd-anchor-link"><span class="tsd-flag ts-flagProtected">Protected</span> cookie<a href="#cookie" aria-label="Permalink" class="tsd-anchor-icon"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5"></path><path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5"></path></svg></a></h3><div class="tsd-signature tsd-kind-icon">cookie<span class="tsd-signature-symbol">:</span> <a href="../interfaces/CookiePayload.html" class="tsd-signature-type" data-tsd-kind="Interface">CookiePayload</a></div><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/dhealthproject/dapps-framework/blob/80c5baa/runtime/backend/src/common/services/AuthService.ts#L127">src/common/services/AuthService.ts:127</a></li></ul></aside><div class="tsd-comment tsd-typography"><div class="lead">
<p>Contains the generated <em>cookie payload</em>. This property is
filled using configuration fields in the <code>config/security.ts</code>
configuration file.</p>
</div><dl class="tsd-comment-tags"><dt>access</dt><dd><p>protected</p>
</dd><dt>var</dt><dd><p>{CookiePayload}</p>
</dd></dl></div></section></section><section class="tsd-panel-group tsd-member-group "><h2>Methods</h2><section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class tsd-is-protected"><a id="findRecentChallenge" class="tsd-anchor"></a><h3 class="tsd-anchor-link"><span class="tsd-flag ts-flagProtected">Protected</span> find<wbr/>Recent<wbr/>Challenge<a href="#findRecentChallenge" aria-label="Permalink" class="tsd-anchor-icon"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5"></path><path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5"></path></svg></a></h3><ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class tsd-is-protected"><li class="tsd-signature tsd-kind-icon">find<wbr/>Recent<wbr/>Challenge<span class="tsd-signature-symbol">(</span>challenge<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">TransferTransaction</span><span class="tsd-signature-symbol">&gt;</span></li></ul><ul class="tsd-descriptions"><li class="tsd-description"><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/dhealthproject/dapps-framework/blob/80c5baa/runtime/backend/src/common/services/AuthService.ts#L463">src/common/services/AuthService.ts:463</a></li></ul></aside><div class="tsd-comment tsd-typography"><div class="lead">
<p>This method fetches <em>recent transactions</em> using the network
service (promises are delegated), and interprets the content
of messages in transfer transactions.
<br /><br />
A <code>TransferTransaction</code> instance <em>will only be returned</em> given
that the <code>challenge</code> <em>can be found in a transaction</em>, otherwise
it returns <code>undefined</code>.</p>
</div><dl class="tsd-comment-tags"><dt>async</dt><dd></dd><dt>access</dt><dd><p>protected</p>
</dd></dl></div><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameters"><li><h5>challenge: <span class="tsd-signature-type">string</span></h5><div class="tsd-comment tsd-typography"><div class="lead">
<p>The authentication challenge to search for in recent transactions.</p>
</div></div></li></ul><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">TransferTransaction</span><span class="tsd-signature-symbol">&gt;</span></h4><div><p>A transfer transaction instance given a validated authentication challenge, or undefined.</p>
</div></li></ul></section><section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class"><a id="getAccessToken" class="tsd-anchor"></a><h3 class="tsd-anchor-link">get<wbr/>Access<wbr/>Token<a href="#getAccessToken" aria-label="Permalink" class="tsd-anchor-icon"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5"></path><path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5"></path></svg></a></h3><ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class"><li class="tsd-signature tsd-kind-icon">get<wbr/>Access<wbr/>Token<span class="tsd-signature-symbol">(</span>payload<span class="tsd-signature-symbol">: </span><a href="../interfaces/AuthenticationPayload.html" class="tsd-signature-type" data-tsd-kind="Interface">AuthenticationPayload</a><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><a href="AccessTokenDTO.html" class="tsd-signature-type" data-tsd-kind="Class">AccessTokenDTO</a><span class="tsd-signature-symbol">&gt;</span></li></ul><ul class="tsd-descriptions"><li class="tsd-description"><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/dhealthproject/dapps-framework/blob/80c5baa/runtime/backend/src/common/services/AuthService.ts#L283">src/common/services/AuthService.ts:283</a></li></ul></aside><div class="tsd-comment tsd-typography"><div class="lead">
<p>This method accepts a <a href="../interfaces/AuthenticationPayload.html">AuthenticationPayload</a> object
of which the <code>address</code> field is used to find the related
<code>accounts</code> document <em>by address</em>.
<br /><br />
We read the access/refresh token(s) from the <code>accounts</code>
document <em>if possible</em>, otherwise we <em>generate them</em> and
<em>sign them using the authentication secret</em> as provided
in the configuration file <code>config/security.ts</code>.
<br /><br />
Note that the expiration of access tokens automatically
happens after one hour of lifetime.</p>
</div></div><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameters"><li><h5>payload: <a href="../interfaces/AuthenticationPayload.html" class="tsd-signature-type" data-tsd-kind="Interface">AuthenticationPayload</a></h5><div class="tsd-comment tsd-typography"><div class="lead">
<p>The authentication payload of validated log-in operation.</p>
</div></div></li></ul><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><a href="AccessTokenDTO.html" class="tsd-signature-type" data-tsd-kind="Class">AccessTokenDTO</a><span class="tsd-signature-symbol">&gt;</span></h4><div><p>An access token for the authenticated user and possibly a refresh token (first time).</p>
</div></li></ul></section><section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class tsd-is-protected"><a id="getAccountQuery" class="tsd-anchor"></a><h3 class="tsd-anchor-link"><span class="tsd-flag ts-flagProtected">Protected</span> get<wbr/>Account<wbr/>Query<a href="#getAccountQuery" aria-label="Permalink" class="tsd-anchor-icon"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5"></path><path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5"></path></svg></a></h3><ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class tsd-is-protected"><li class="tsd-signature tsd-kind-icon">get<wbr/>Account<wbr/>Query<span class="tsd-signature-symbol">(</span>payload<span class="tsd-signature-symbol">: </span><a href="../interfaces/AuthenticationPayload.html" class="tsd-signature-type" data-tsd-kind="Interface">AuthenticationPayload</a><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><a href="AccountQuery.html" class="tsd-signature-type" data-tsd-kind="Class">AccountQuery</a></li></ul><ul class="tsd-descriptions"><li class="tsd-description"><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/dhealthproject/dapps-framework/blob/80c5baa/runtime/backend/src/common/services/AuthService.ts#L409">src/common/services/AuthService.ts:409</a></li></ul></aside><div class="tsd-comment tsd-typography"><div class="lead">
<p>This method returns an <em>accounts query</em> for the mongo collection
named <code>accounts</code>, and is used to query an account by the address
attached inside the <a href="../interfaces/AuthenticationPayload.html">AuthenticationPayload</a> payload.</p>
</div><dl class="tsd-comment-tags"><dt>access</dt><dd><p>protected</p>
</dd></dl></div><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameters"><li><h5>payload: <a href="../interfaces/AuthenticationPayload.html" class="tsd-signature-type" data-tsd-kind="Interface">AuthenticationPayload</a></h5></li></ul><h4 class="tsd-returns-title">Returns <a href="AccountQuery.html" class="tsd-signature-type" data-tsd-kind="Class">AccountQuery</a></h4><div></div></li></ul></section><section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class"><a id="getChallenge" class="tsd-anchor"></a><h3 class="tsd-anchor-link">get<wbr/>Challenge<a href="#getChallenge" aria-label="Permalink" class="tsd-anchor-icon"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5"></path><path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5"></path></svg></a></h3><ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class"><li class="tsd-signature tsd-kind-icon">get<wbr/>Challenge<span class="tsd-signature-symbol">(</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">string</span></li></ul><ul class="tsd-descriptions"><li class="tsd-description"><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/dhealthproject/dapps-framework/blob/80c5baa/runtime/backend/src/common/services/AuthService.ts#L194">src/common/services/AuthService.ts:194</a></li></ul></aside><div class="tsd-comment tsd-typography"><div class="lead">
<p>This method generates a random authentication challenge.
<br /><br />
The size of the generated authentication challenges can be changed
in the configuration file <code>config/security.ts</code>.
<br /><br />
Note that by modifying the default <em>challenge size</em>, you may
affect the operations processor and thereby the data that is
returned by the backend.</p>
</div></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">string</span></h4><div><p>An authentication challenge that can be attached on-chain.</p>
</div></li></ul></section><section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class"><a id="getCookie" class="tsd-anchor"></a><h3 class="tsd-anchor-link">get<wbr/>Cookie<a href="#getCookie" aria-label="Permalink" class="tsd-anchor-icon"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5"></path><path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5"></path></svg></a></h3><ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class"><li class="tsd-signature tsd-kind-icon">get<wbr/>Cookie<span class="tsd-signature-symbol">(</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><a href="../interfaces/CookiePayload.html" class="tsd-signature-type" data-tsd-kind="Interface">CookiePayload</a></li></ul><ul class="tsd-descriptions"><li class="tsd-description"><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/dhealthproject/dapps-framework/blob/80c5baa/runtime/backend/src/common/services/AuthService.ts#L177">src/common/services/AuthService.ts:177</a></li></ul></aside><div class="tsd-comment tsd-typography"><div class="lead">
<p>This method returns the configured <em>cookie payload</em>. Note that
we do not permit the <em>secret</em> to be shared by destructuring it
out of the returned payload, i.e. the secret is never returned
with this method.</p>
</div></div><h4 class="tsd-returns-title">Returns <a href="../interfaces/CookiePayload.html" class="tsd-signature-type" data-tsd-kind="Interface">CookiePayload</a></h4><div><p>A cookie payload without the <em>secret</em> field.</p>
</div></li></ul></section><section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class tsd-is-protected"><a id="getTransactionQuery" class="tsd-anchor"></a><h3 class="tsd-anchor-link"><span class="tsd-flag ts-flagProtected">Protected</span> get<wbr/>Transaction<wbr/>Query<a href="#getTransactionQuery" aria-label="Permalink" class="tsd-anchor-icon"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5"></path><path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5"></path></svg></a></h3><ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class tsd-is-protected"><li class="tsd-signature tsd-kind-icon">get<wbr/>Transaction<wbr/>Query<span class="tsd-signature-symbol">(</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">any</span></li></ul><ul class="tsd-descriptions"><li class="tsd-description"><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/dhealthproject/dapps-framework/blob/80c5baa/runtime/backend/src/common/services/AuthService.ts#L428">src/common/services/AuthService.ts:428</a></li></ul></aside><div class="tsd-comment tsd-typography"><div class="lead">
<p>This method returns a <strong>transactions query</strong> that is compatible
with dHealth Network Node&#39;s REST gateway.
<br /><br />
To change the registry, you can modify the <code>auth.registries</code>
configuration field in <code>config/security.ts</code>. Please, note that
changing this configuration field may affect <em>ongoing log-in</em>
operations of end-users.</p>
</div><dl class="tsd-comment-tags"><dt>link</dt><dd><p><a href="https://docs.dhealth.com/reference/searchconfirmedtransactions">https://docs.dhealth.com/reference/searchconfirmedtransactions</a></p>
</dd><dt>access</dt><dd><p>protected</p>
</dd></dl></div><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">any</span></h4><div><p>A REST-gateway compatible transaction <em>search</em> query.</p>
</div></li></ul></section><section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class"><a id="refreshAccessToken" class="tsd-anchor"></a><h3 class="tsd-anchor-link">refresh<wbr/>Access<wbr/>Token<a href="#refreshAccessToken" aria-label="Permalink" class="tsd-anchor-icon"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5"></path><path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5"></path></svg></a></h3><ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class"><li class="tsd-signature tsd-kind-icon">refresh<wbr/>Access<wbr/>Token<span class="tsd-signature-symbol">(</span>userAddress<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">string</span>, refreshToken<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><a href="AccessTokenDTO.html" class="tsd-signature-type" data-tsd-kind="Class">AccessTokenDTO</a><span class="tsd-signature-symbol">&gt;</span></li></ul><ul class="tsd-descriptions"><li class="tsd-description"><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/dhealthproject/dapps-framework/blob/80c5baa/runtime/backend/src/common/services/AuthService.ts#L355">src/common/services/AuthService.ts:355</a></li></ul></aside><div class="tsd-comment tsd-typography"><div class="lead">
<p>This method accepts an end-user address (string) and a
<em>refresh token</em> which must be valid as a pair.
<br /><br />
This method will <em>generate a new access token</em>,
<em>sign it using the authentication secret</em> as provided
in the configuration file <code>config/security.ts</code> and
returns it in a <a href="AccessTokenDTO.html">AccessTokenDTO</a> object.
<br /><br />
Note that the expiration of access tokens automatically
happens after one hour of lifetime.</p>
</div><dl class="tsd-comment-tags"><dt>access</dt><dd><p>public</p>
</dd><dt>async</dt><dd></dd><dt>throws</dt><dd><p>{HttpException}             Given invalid log-in state for the requested account.</p>
</dd></dl></div><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameters"><li><h5>userAddress: <span class="tsd-signature-type">string</span></h5><div class="tsd-comment tsd-typography"><div class="lead">
<p>The address of the end-user for which a new access token must be generated (&quot;Refresh&quot;).</p>
</div></div></li><li><h5>refreshToken: <span class="tsd-signature-type">string</span></h5></li></ul><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><a href="AccessTokenDTO.html" class="tsd-signature-type" data-tsd-kind="Class">AccessTokenDTO</a><span class="tsd-signature-symbol">&gt;</span></h4><div><p>An access token for the authenticated user.</p>
</div></li></ul></section><section class="tsd-panel tsd-member tsd-kind-method tsd-parent-kind-class"><a id="validateChallenge" class="tsd-anchor"></a><h3 class="tsd-anchor-link">validate<wbr/>Challenge<a href="#validateChallenge" aria-label="Permalink" class="tsd-anchor-icon"><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5"></path><path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5"></path></svg></a></h3><ul class="tsd-signatures tsd-kind-method tsd-parent-kind-class"><li class="tsd-signature tsd-kind-icon">validate<wbr/>Challenge<span class="tsd-signature-symbol">(</span>challenge<span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">string</span><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">: </span><span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><a href="../interfaces/AuthenticationPayload.html" class="tsd-signature-type" data-tsd-kind="Interface">AuthenticationPayload</a><span class="tsd-signature-symbol">&gt;</span></li></ul><ul class="tsd-descriptions"><li class="tsd-description"><aside class="tsd-sources"><ul><li>Defined in <a href="https://github.com/dhealthproject/dapps-framework/blob/80c5baa/runtime/backend/src/common/services/AuthService.ts#L215">src/common/services/AuthService.ts:215</a></li></ul></aside><div class="tsd-comment tsd-typography"><div class="lead">
<p>This method <em>validates</em> the presence of an <em>authentication challenge</em>
on-chain, in transfer transaction messages. When we can&#39;t find a recent
transaction (confirmed/unconfirmed) that contains the <code>challenge</code> value
this method will throw a <code>HttpException</code> with status code <strong>401</strong>.
<br /><br />
In case of a <em>successful</em> validation attempts, i.e. when the <code>challenge</code>
parameter <strong>has been found</strong> in a recent transfer transaction&#39;s message,
a document will be <em>insert</em> in the collection <code>authChallenges</code>.</p>
</div><dl class="tsd-comment-tags"><dt>throws</dt><dd><p>{HttpException}           Given challenge could not be found in recent transactions.</p>
</dd></dl></div><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameters"><li><h5>challenge: <span class="tsd-signature-type">string</span></h5><div class="tsd-comment tsd-typography"><div class="lead">
<p>An authentication challenge, as created with <a href="AuthService.html#getChallenge">getChallenge</a>.</p>
</div></div></li></ul><h4 class="tsd-returns-title">Returns <span class="tsd-signature-type">Promise</span><span class="tsd-signature-symbol">&lt;</span><a href="../interfaces/AuthenticationPayload.html" class="tsd-signature-type" data-tsd-kind="Interface">AuthenticationPayload</a><span class="tsd-signature-symbol">&gt;</span></h4><div><p>An authenticated account described with <a href="../interfaces/AuthenticationPayload.html">AuthenticationPayload</a>.</p>
</div></li></ul></section></section></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class=""><a href="../modules.html">Exports</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="current tsd-kind-class"><a href="AuthService.html" class="tsd-kind-icon">Auth<wbr/>Service</a><ul><li class="tsd-kind-constructor tsd-parent-kind-class"><a href="AuthService.html#constructor" class="tsd-kind-icon">constructor</a></li><li class="tsd-kind-property tsd-parent-kind-class tsd-is-protected"><a href="AuthService.html#challengeSize" class="tsd-kind-icon">challenge<wbr/>Size</a></li><li class="tsd-kind-property tsd-parent-kind-class tsd-is-protected"><a href="AuthService.html#cookie" class="tsd-kind-icon">cookie</a></li><li class="tsd-kind-method tsd-parent-kind-class tsd-is-protected"><a href="AuthService.html#findRecentChallenge" class="tsd-kind-icon">find<wbr/>Recent<wbr/>Challenge</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="AuthService.html#getAccessToken" class="tsd-kind-icon">get<wbr/>Access<wbr/>Token</a></li><li class="tsd-kind-method tsd-parent-kind-class tsd-is-protected"><a href="AuthService.html#getAccountQuery" class="tsd-kind-icon">get<wbr/>Account<wbr/>Query</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="AuthService.html#getChallenge" class="tsd-kind-icon">get<wbr/>Challenge</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="AuthService.html#getCookie" class="tsd-kind-icon">get<wbr/>Cookie</a></li><li class="tsd-kind-method tsd-parent-kind-class tsd-is-protected"><a href="AuthService.html#getTransactionQuery" class="tsd-kind-icon">get<wbr/>Transaction<wbr/>Query</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="AuthService.html#refreshAccessToken" class="tsd-kind-icon">refresh<wbr/>Access<wbr/>Token</a></li><li class="tsd-kind-method tsd-parent-kind-class"><a href="AuthService.html#validateChallenge" class="tsd-kind-icon">validate<wbr/>Challenge</a></li></ul></li></ul></nav></div></div></div><footer class="with-border-bottom"><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li><li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li><li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-constructor tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited constructor</span></li><li class="tsd-kind-property tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited property</span></li><li class="tsd-kind-method tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected property</span></li><li class="tsd-kind-method tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private property</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-method tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static method</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="container tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script src="../assets/main.js"></script></body></html>